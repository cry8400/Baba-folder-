<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Baba Folder</title>

<style>
:root{
--bg:#ffffff;
--text:#111;
--card:#f2f2f2;
}

body.dark{
--bg:#0f0f0f;
--text:#ffffff;
--card:#1c1c1c;
}

body{
margin:0;
font-family:Arial, sans-serif;
background:var(--bg);
color:var(--text);
transition:0.3s;
}

header{
padding:20px;
text-align:center;
font-size:28px;
font-weight:bold;
background:linear-gradient(45deg,#ff4b2b,#ff416c,#6a11cb);
color:white;
position:relative;
}

.toggle{
position:absolute;
right:20px;
top:20px;
cursor:pointer;
padding:6px 12px;
background:white;
border-radius:20px;
font-size:12px;
color:black;
}

.searchBox{
margin:20px auto;
max-width:500px;
text-align:center;
}

.searchBox input{
width:90%;
padding:10px;
border-radius:20px;
border:1px solid #ccc;
outline:none;
}

.company{
margin:15px;
background:var(--card);
border-radius:10px;
overflow:hidden;
}

.company-header{
padding:15px;
font-size:18px;
font-weight:bold;
cursor:pointer;
position:relative;
}

.company-header::after{
content:"↓";
position:absolute;
right:20px;
transition:0.3s;
}

.company-header.active::after{
transform:rotate(180deg);
}

.company-content{
max-height:0;
overflow:hidden;
transition:max-height 0.4s ease;
padding:0 15px;
}

.model{
display:flex;
justify-content:space-between;
padding:8px 0;
border-bottom:1px solid #ccc;
}

.model:last-child{
border-bottom:none;
}
</style>
</head>

<body>

<header>
Baba Folder
<div class="toggle" onclick="toggleMode()">Mode</div>
</header>

<div class="searchBox">
<input type="text" id="searchInput" placeholder="Search model or company...">
</div>

<div id="dataContainer"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBUals9JsemB1NZk9byCaQyx-IESPTCnuU",
  authDomain: "baba-folder.firebaseapp.com",
  projectId: "baba-folder",
  storageBucket: "baba-folder.firebasestorage.app",
  messagingSenderId: "641161753750",
  appId: "1:641161753750:web:d80be1d6affbae5ffffeb7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const container = document.getElementById("dataContainer");
const searchInput = document.getElementById("searchInput");

let allData = [];

async function loadData(){
  container.innerHTML="Loading...";
  const snapshot = await getDocs(collection(db,"prices"));
  allData=[];
  snapshot.forEach(doc=>{
    allData.push(doc.data());
  });
  renderData(allData);
}

function renderData(data, searchValue=""){
  let html="";

  data.forEach(item=>{

    let modelsToShow = item.models;

    if(searchValue){
      modelsToShow = item.models.filter(m =>
        m.name.toLowerCase().includes(searchValue)
      );
    }

    if(modelsToShow.length === 0) return;

    html+=`
    <div class="company">
      <div class="company-header active">${item.company}</div>
      <div class="company-content" style="max-height:1000px;">
    `;

    modelsToShow.forEach(model=>{
      html+=`
      <div class="model">
        <span>${model.name}</span>
        <span>₹ ${model.price}</span>
      </div>
      `;
    });

    html+=`</div></div>`;
  });

  container.innerHTML = html;
}
searchInput.addEventListener("input",function(){
  const value=this.value.toLowerCase();
  const filtered=allData.filter(item=>{
    if(item.company.toLowerCase().includes(value)) return true;
    return item.models.some(m=>m.name.toLowerCase().includes(value));
  });
  renderData(filtered);
});

loadData();

/* Accordion */
document.addEventListener("click",function(e){
  if(e.target.classList.contains("company-header")){
    const headers=document.querySelectorAll(".company-header");
    headers.forEach(h=>{
      if(h!==e.target){
        h.classList.remove("active");
        h.nextElementSibling.style.maxHeight=null;
      }
    });

    e.target.classList.toggle("active");
    const content=e.target.nextElementSibling;

    if(e.target.classList.contains("active")){
      content.style.maxHeight=content.scrollHeight+"px";
    }else{
      content.style.maxHeight=null;
    }
  }
});

/* Dark Mode */
window.toggleMode=function(){
  document.body.classList.toggle("dark");
  localStorage.setItem("mode",document.body.classList.contains("dark"));
}

if(localStorage.getItem("mode")==="true"){
  document.body.classList.add("dark");
}
</script>

</body>
</html>
