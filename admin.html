<!DOCTYPE html>
<html>
<head>
<title>Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  font-family:sans-serif;
  margin:0;
  padding:15px;
  background:#f1f5f9;
  transition:.3s;
}
.dark{
  background:#0f172a;
  color:white;
}
.card{
  background:white;
  padding:15px;
  margin:10px 0;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.2);
}
.dark .card{
  background:#1e293b;
}
button{
  padding:6px 10px;
  margin:4px;
  border:none;
  border-radius:6px;
}
.add{background:#22c55e;color:white;}
.delete{background:#ef4444;color:white;}
.edit{background:#f59e0b;color:white;}
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
input{
  padding:8px;
  margin:5px 0;
}
</style>
</head>
<body>

<div class="topbar">
<h2>Admin Panel</h2>
<div>
<button onclick="toggleDark()">ðŸŒ™</button>
<button onclick="logout()">Logout</button>
</div>
</div>

<input type="text" id="companyInput" placeholder="Company Name">
<button class="add" onclick="addCompany()">Add Company</button>

<div id="list"></div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signOut, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBUals9JsemB1NZk9byCaQyx-IESPTCnuU",
  authDomain: "baba-folder.firebaseapp.com",
  projectId: "baba-folder",
  storageBucket: "baba-folder.firebasestorage.app",
  messagingSenderId: "641161753750",
  appId: "1:641161753750:web:d80be1d6affbae5ffffeb7"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth,(user)=>{
  if(!user){
    window.location.href="index.html";
  } else {
    if(user.email !== "gc4raven1@gmail.com){
      alert("Access Denied");
      signOut(auth);
      window.location.href="index.html";
    }
  }
});

window.logout = function(){
  signOut(auth);
}

window.toggleDark = function(){
  document.body.classList.toggle("dark");
}

async function addCompany(){
  if(!companyInput.value) return;
  await addDoc(collection(db,"companies"),{
    name: companyInput.value,
    models:[]
  });
  companyInput.value="";
  loadData();
}

async function loadData(){
  list.innerHTML="";
  const querySnapshot = await getDocs(collection(db,"companies"));
  querySnapshot.forEach((docSnap)=>{
    const data = docSnap.data();
    const id = docSnap.id;

    let card = document.createElement("div");
    card.className="card";

    let html = `
      <h3>${data.name}</h3>
      <button class="add" onclick="addModel('${id}')">Add Model</button>
      <button class="delete" onclick="deleteCompany('${id}')">Delete</button>
      <div>
    `;

    data.models.forEach((m,i)=>{
      html+=`
        <p>
        ${m}
        <button class="edit" onclick="editModel('${id}',${i},'${m}')">Edit</button>
        </p>
      `;
    });

    html+=`</div>`;
    card.innerHTML=html;
    list.appendChild(card);
  });
}

window.deleteCompany = async function(id){
  await deleteDoc(doc(db,"companies",id));
  loadData();
}

window.addModel = async function(id){
  let model = prompt("Model name");
  if(!model) return;

  const docRef = doc(db,"companies",id);
  const snapshot = await getDocs(collection(db,"companies"));
  
  snapshot.forEach(async (d)=>{
    if(d.id===id){
      let models=d.data().models;
      models.push(model);
      await updateDoc(docRef,{models});
      loadData();
    }
  });
}

window.editModel = async function(id,index,oldVal){
  let newVal = prompt("Edit model",oldVal);
  if(!newVal) return;

  const docRef = doc(db,"companies",id);
  const snapshot = await getDocs(collection(db,"companies"));

  snapshot.forEach(async (d)=>{
    if(d.id===id){
      let models=d.data().models;
      models[index]=newVal;
      await updateDoc(docRef,{models});
      loadData();
    }
  });
}

loadData();

</script>
</body>
</html>
